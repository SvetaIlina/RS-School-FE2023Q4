(()=>{"use strict";function e(e,...t){const i=document.createElement(e);return i.classList.add(...t),i}function t(e){return e>=0&&e<10?`0${e}`:e}function i(){return document.querySelector(".sound-btn").classList.contains("crossed")}function s(){const e=document.querySelector(".game-field"),t=Array.from(document.querySelectorAll(".ceil")),i=t.filter((e=>"true"===e.dataset.fill)),s=t.filter((e=>"false"===e.dataset.fill));return{feild:e,allCeils:t,fillCeils:i,emptyCeil:s}}function n(){return{sec:document.querySelector("#sec"),min:document.querySelector("#min"),hour:document.querySelector("#hour")}}function a(){const{sec:e,min:t,hour:i}=n();return+e.innerText+60*+t.innerText+3600*+i.innerText}class c{constructor(e,t,i){this.classes=e,this.text=t,this.cb=i}buildBtn(){return this.btn=e("button",this.classes),"string"==typeof this.text&&(this.btn.innerText=this.text),this.cb&&this.btn.addEventListener("click",this.cb),this.btn}}class l{constructor(e,t,i){this.classes=e,this.href=t,this.text=i}buildLink(){return this.link=e("a",this.classes),this.link.setAttribute("href",this.href),this.link.innerText=this.text,this.link}}const o=JSON.parse('[{"id":"easy","size":5,"width":"60px","img":[{"id":"lion","src":"assets/images/lion.png","matrix":[[0,1,1,1,0],[1,1,1,1,0],[1,1,1,1,0],[0,1,1,1,1],[1,1,1,1,1]]},{"id":"rose","src":"assets/images/rose.png","matrix":[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]]},{"id":"piggy","src":"assets/images/piggy.png","matrix":[[1,1,1,1,0],[0,1,1,1,1],[1,1,0,1,0],[1,1,1,1,1],[1,1,1,1,0]]},{"id":"tree","src":"assets/images/tree.png","matrix":[[1,1,1,1,1],[1,1,0,1,1],[0,1,1,1,0],[0,0,1,0,0],[1,1,1,1,1]]},{"id":"duck","src":"assets/images/duck.png","matrix":[[0,1,1,1,0],[0,1,0,1,1],[0,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]]}]},{"id":"medium","size":10,"width":"33px","img":[{"id":"sunrise","src":"assets/images/sunrise.png","matrix":[[0,0,0,1,1,1,1,0,0,0],[0,0,1,1,0,0,1,1,0,0],[0,1,1,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,1,1,0,0],[0,0,0,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1]]},{"id":"bamboo","src":"assets/images/bamboo.png","matrix":[[1,1,0,0,1,1,0,0,1,1],[1,1,0,1,1,1,0,0,1,1],[1,1,0,1,1,1,0,1,1,1],[1,1,0,0,1,1,0,1,1,1],[1,1,0,0,1,1,0,0,1,1],[1,1,1,0,1,1,0,0,1,1],[1,1,1,0,1,1,1,0,1,1],[1,1,0,0,1,1,1,0,1,1],[1,1,0,0,1,1,0,0,1,1],[1,1,0,0,1,1,0,0,1,1]]},{"id":"samurai","src":"assets/images/samurai.png","matrix":[[0,1,0,1,0,1,0,0,0,0],[0,1,0,1,1,1,1,0,0,0],[0,1,0,0,1,1,1,1,0,0],[0,1,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1],[0,1,0,0,1,1,1,0,0,0],[0,1,0,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1],[0,1,0,0,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,0]]},{"id":"fan","src":"assets/images/fan.png","matrix":[[0,1,1,0,0,0,0,0,0,0],[0,1,0,1,1,0,0,0,0,0],[0,1,1,1,1,0,0,0,0,0],[0,1,1,1,0,1,1,0,0,0],[0,1,1,0,1,1,1,0,0,0],[0,1,0,1,1,1,0,1,1,0],[0,1,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1],[0,1,0,0,0,0,0,0,0,0]]},{"id":"gardener","src":"assets/images/gardener.png","matrix":[[0,0,0,0,1,1,1,1,0,0],[1,1,0,1,1,1,1,1,1,0],[1,1,0,1,1,1,1,0,1,0],[1,1,1,1,1,0,1,0,1,1],[0,0,1,1,0,0,0,0,1,1],[1,1,1,1,0,0,0,1,1,1],[0,1,1,1,1,0,0,1,1,1],[0,0,1,1,1,1,1,1,1,1],[0,0,0,0,1,1,1,1,1,1],[0,0,0,0,1,1,1,1,0,0]]}]},{"id":"hard","size":15,"width":"23px","img":[{"id":"lion","src":"assets/images/lev.png","matrix":[[0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,0,1,1,0,0,0],[0,1,1,0,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,0,0,1,0,0,1,0,1,1,0,0,0],[0,1,1,1,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,0,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,1,0,0,0,0,0,1,1,1,0,0,1],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,1],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,1],[0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,1,0,0,0,1,1,1,0,0,0,1,1,0,0],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,0]]},{"id":"pyramid","src":"assets/images/piramida.png","matrix":[[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,1,1,0,0,0,0,0,1,1,1,0,0,0],[0,1,1,1,1,0,0,0,1,1,1,1,1,0,0],[0,1,1,1,1,0,0,1,1,1,1,1,1,1,0],[0,0,1,1,0,0,1,1,0,0,1,1,1,1,1],[0,0,0,0,0,1,1,0,0,1,1,1,1,1,1],[0,0,0,0,1,1,0,0,1,1,1,1,1,1,1],[0,0,0,1,1,0,0,1,1,1,1,1,1,1,1],[0,0,1,1,0,0,1,1,1,1,1,1,1,1,1],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,1,1,1,1,1,0,1,1,1,0,1,1],[1,1,1,1,0,0,0,0,1,1,1,0,0,0,1],[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0]]},{"id":"flamingo","src":"assets/images/flamingo.png","matrix":[[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,0,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,0,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,0]]},{"id":"giraffe","src":"assets/images/zhiraf.png","matrix":[[0,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,0,1,0,0,0,1,0,1,1],[0,0,0,0,0,1,0,1,0,0,0,1,0,1,0]]},{"id":"palm","src":"assets/images/palma.png","matrix":[[0,0,0,0,1,1,1,1,1,0,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0,0,1,1,1,0],[0,0,1,1,1,1,1,1,0,0,0,0,1,1,1],[0,0,1,1,1,1,1,1,1,1,0,0,1,1,1],[0,0,1,0,0,1,1,1,1,1,1,0,1,1,1],[0,0,0,0,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,1,1,1,0,0,0,1,1,1,0,0,1],[0,0,1,1,1,0,0,0,0,1,1,0,0,0,0],[0,0,1,1,1,0,0,0,0,1,0,0,0,0,0],[0,1,1,1,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0]]}]}]');class r{constructor(e=0,t=[],i="25px"){this.fiedSize=e,this.ceilSize=i,this.img=t}buildField(){return this.field=e("div","game-field"),this.field.append(this.buildTable(this.fiedSize,this.img),this.buildHint(this.fiedSize,this.ceilSize,"top"),this.buildHint(this.fiedSize,this.ceilSize,"left"),new c("sound-btn","",y).buildBtn()),this.field}buildTable(t,i){this.table=e("table","table");for(let s=0;s<t;s++){const n=e("tr","row");for(let a=0;a<t;a++){const t=e("td","ceil");t.style.width=this.ceilSize,t.style.height=this.ceilSize,t.dataset.coord=`${s}-${a}`,1===i[s][a]?t.dataset.fill=!0:t.dataset.fill=!1,n.append(t)}this.table.append(n)}return this.table.addEventListener("click",(e=>f(e))),this.table.addEventListener("contextmenu",(e=>{f(e),e.preventDefault()})),this.table.addEventListener("click",b,{once:!0}),this.table.addEventListener("click",v),this.table}buildHint(t,i,s){const n=[];this.hints=e("div",`${s}-hints`);for(let a=0;a<t;a++){const t=e("div",`${s}-hint`);t.setAttribute("id",`${a}`),n.push(t),"top"===s?t.style.width=i:"left"===s&&(t.style.height=i),this.hints.append(t)}return"top"===s?this.setHints(n,"column"):"left"===s&&this.setHints(n,"row"),this.hints}setHints(e,t){for(let i=0;i<this.fiedSize;i++){const s=e.find((e=>e.getAttribute("id")===`${i}`));let n=0;for(let e=0;e<this.fiedSize;e++)"row"===t&&1===this.img[i][e]&&(n+=1,e!==this.fiedSize-1&&0!==this.img[i][e+1]||(this.getHint(s,`${n}`),n=0)),"column"===t&&1===this.img[e][i]&&(n+=1,e!==this.fiedSize-1&&0!==this.img[e+1][i]||(this.getHint(s,`${n}`),n=0))}}getHint(t,i){this.hint=e("div","hint"),this.hint.innerText=i,this.hint.addEventListener("click",(e=>e.target.classList.toggle("hint--checked"))),t.append(this.hint)}}class d{constructor(e){this.classes=e}buildModal(t){return this.overlay=e("div","overlay"),this.modal=e("div",this.classes),this.closeBtn=e("button","close-btn"),this.closeBtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="30" height="30"><path d="M19,2H5C2.243,2,0,4.243,0,7v10c0,2.757,2.243,5,5,5h14c2.757,0,5-2.243,5-5V7c0-2.757-2.243-5-5-5Zm3,15c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V7c0-1.654,1.346-3,3-3h14c1.654,0,3,1.346,3,3v10Zm-5.793-7.793l-2.793,2.793,2.793,2.793c.391,.391,.391,1.023,0,1.414-.195,.195-.451,.293-.707,.293s-.512-.098-.707-.293l-2.793-2.793-2.793,2.793c-.195,.195-.451,.293-.707,.293s-.512-.098-.707-.293c-.391-.391-.391-1.023,0-1.414l2.793-2.793-2.793-2.793c-.391-.391-.391-1.023,0-1.414s1.023-.391,1.414,0l2.793,2.793,2.793-2.793c.391-.391,1.023-.391,1.414,0s.391,1.023,0,1.414Z"/></svg>',"string"==typeof t?this.modal.innerText=t:this.modal.append(t),this.modal.append(this.closeBtn),this.overlay.append(this.modal),this.overlay.addEventListener("click",this.closeModal),this.overlay}closeModal(e){(e.target.classList.contains("overlay")||e.target.classList.contains("close-btn"))&&(document.querySelector("audio")&&document.querySelector("audio").pause(),document.querySelector(".overlay").remove())}}let m,u,h={};function g(e){let t,i=0;"random-game"===e.target.getAttribute("id")&&(i=Math.floor(Math.random()*o.length)),t=o[i],S(t,t.img[Math.floor(Math.random()*t.img.length)])}function p(t){let i;i="change-puzzle"!==t.target.getAttribute("id")?t.target.getAttribute("id"):h.level;const s=o.find((e=>e.id===i)),n=e("div","modal-content");s.img.forEach((t=>{const i=e("div","modal-item","level-cont"),a=e("img","modal-img"),c=e("h6","item-title");c.innerText=`${t.id.toUpperCase()}`,a.setAttribute("src",`${t.src}`),i.addEventListener("click",(()=>{const e=s.img.find((e=>e.id===t.id));S(s,e),document.querySelector(".overlay").remove()})),i.append(a,c),n.append(i)})),document.body.append(new d("modal").buildModal(n))}function f(e){let t;e.target.classList.contains("ceil")&&("click"!==e.type||e.target.classList.contains("crossed")?"contextmenu"!==e.type||e.target.classList.contains("ceil--fill")||(t=new Audio("assets/sound/cross.mp3"),e.target.classList.toggle("crossed")):(t=new Audio("assets/sound/fill.mp3"),e.target.classList.toggle("ceil--fill")),i()||t.play())}function b(e,i=0,s=0,a=0){const{sec:c,min:l,hour:o}=n();let r=i,d=s,u=a;m=setInterval((function(){r++,r>59&&(d++,l.innerText=t(d),r=0),d>59&&(u++,o.innerText=t(u),d=0),c.innerText=t(r)}),1e3)}function v(){const t=e=>e.classList.contains("ceil--fill"),{feild:n,allCeils:c,fillCeils:l,emptyCeil:o}=s();if(l.every(t)&&!o.some(t)){clearInterval(m),c.forEach((e=>e.classList.remove("crossed"))),n.classList.add("game-field--disable"),function(t){const s=e("div","modal-item"),n=e("img","modal-img"),c=e("h6","item-title"),l=a(),o=e("audio","audio");o.setAttribute("src","assets/sound/happy.mp3"),c.innerText=`Great! You have solved the nonogram in ${l} seconds!`,n.setAttribute("src",`${t.src}`),s.append(c,o,n),document.body.append(new d("modal").buildModal(s)),i()||o.play()}(h);const t={name:h.id,img:h.src,level:h.level,time:a()};5===u.length&&u.shift(),u.push(t),localStorage.setItem("wins",JSON.stringify(u))}}function y(e){e.target.classList.toggle("crossed"),e.target.classList.contains("crossed")?localStorage.setItem("sound","off"):localStorage.setItem("sound","on")}function x(){const{sec:e,min:t,hour:i}=n();e.innerText="00",t.innerText="00",i.innerText="00",clearInterval(m)}function S(e,t){const i=new r(e.size,t.matrix,e.width).buildField();document.querySelector(".game-field").replaceWith(i),"off"===localStorage.getItem("sound")&&document.querySelector(".sound-btn").classList.add("crossed"),x(),h.id=t.id,h.src=t.src,h.matrix=t.matrix,h.level=e.id,console.log(h)}u=localStorage.getItem("wins")?JSON.parse(localStorage.getItem("wins")):[];const w=[{parent:"header",buttons:[{content:"Best results",callback:function(){const i=Array.from(u);i.sort(((e,t)=>e.time-t.time));const s=new d("modal"),n=function(i){const s=e("table","win-list"),n=e("tr","table-title"),a=e("th","win-descr");a.innerText="name";const c=e("th","win-descr");c.innerText="image";const l=e("th","win-descr");l.innerText="level";const o=e("th","win-descr");return o.innerText="time",n.append(a,c,l,o),s.append(n),i.forEach((i=>{const n=e("tr","win-item"),a=e("td","win-descr");a.innerText=i.name;const c=e("td","win-descr"),l=e("img","win-img");l.src=i.img,c.append(l);const o=e("td","win-descr");o.innerText=i.level;const r=e("td","win-descr");r.innerText=`${t(Math.trunc(i.time/60))} : ${t(i.time%60)}`,n.append(a,c,o,r),s.append(n)})),s}(i);document.body.append(s.buildModal(n)),console.log(u,i)}},{content:"Change theme",callback:function(){const e="--theme: dark;";document.documentElement.style.cssText===e?(document.documentElement.style.cssText="",localStorage.setItem("theme","light")):(document.documentElement.style.cssText=e,localStorage.setItem("theme","dark"))}}]},{parent:"main",buttons:[{content:"New game",callback:function(e){g(e),e.target.parentNode.classList.add("up")}},{content:"Continue saved game",callback:function(){const e=JSON.parse(localStorage.savedGame),t=o.find((t=>t.id===e.level)),i=t.img.find((t=>t.id===e.id));S(t,i),document.querySelector("table").removeEventListener("click",b,{once:!0});const{curSec:s,curMin:a,curHour:c}=e.time,{sec:l,min:r,hour:d}=n();l.innerText=s,r.innerText=a,d.innerText=c,document.querySelectorAll(".ceil").forEach((t=>{const[i,s]=t.dataset.coord.split("-");1===e.currentMatrix[i][s]?t.classList.add("ceil--fill"):-1===e.currentMatrix[i][s]&&t.classList.add("crossed")})),document.querySelector("table").addEventListener("click",(e=>b(0,+s,+a,+c)),{once:!0}),event.target.parentNode.classList.add("up")}}]},{parent:"level",buttons:[{content:"Easy (5*5)",callback:p},{content:"Medium (10*10)",callback:p},{content:"Hard (15*15)",callback:p},{content:"Random game",callback:g}]},{parent:"control",buttons:[{content:"Select level"},{content:"Show solution",callback:function(){const{feild:e,allCeils:t,fillCeils:i,emptyCeil:n}=s();t.forEach((e=>e.classList.remove("ceil--fill","crossed"))),i.forEach((e=>e.classList.add("ceil--fill"))),n.forEach((e=>e.classList.add("crossed"))),e.classList.add("game-field--disable"),clearInterval(m),document.querySelector("#save-game").disabled=!0}},{content:"Reset game",callback:function(){const e=s().allCeils,t=s().feild,i=document.querySelector(".table");e.forEach((e=>e.classList.remove("ceil--fill","crossed"))),t.classList.contains("game-field--disable")&&(t.classList.remove("game-field--disable"),i.addEventListener("click",b,{once:!0}),x())}},{content:"Change puzzle",callback:p},{content:"Save game",callback:function(){const{sec:e,min:t,hour:i}=n(),s={curSec:e.innerText,curMin:t.innerText,curHour:i.innerText},a={};Object.assign(a,h);const c=JSON.parse(JSON.stringify(h.matrix));document.querySelectorAll(".ceil").forEach((e=>{const[t,i]=e.dataset.coord.split("-");e.classList.contains("ceil--fill")?c[t][i]=1:e.classList.contains("crossed")?c[t][i]=-1:c[t][i]=0})),a.currentMatrix=c,a.time=s,document.body.append(new d("modal").buildModal("the game was saved")),setTimeout((()=>document.querySelector(".overlay").remove()),1e3),localStorage.savedGame=JSON.stringify(a)}},{content:"Main page",callback:function(){document.querySelectorAll(".screen").forEach((e=>e.classList.remove("up")))}}]}];function L(e){w.find((t=>t.parent===e.dataset.id)).buttons.forEach((t=>{const i=t.content,s=i.match(/[^*)(\d]/gi).join("").trim(),n=t.callback,a=new c("btn",i,n).buildBtn();a.setAttribute("id",`${s.toLowerCase().split(" ").join("-")}`),e.append(a),e.classList.contains("level__list")&&(a.setAttribute("popovertargetaction","hide"),a.setAttribute("popovertarget","level-items"))}))}!function(){"dark"===localStorage.getItem("theme")&&(document.documentElement.style.cssText="--theme: dark;");const t=e("div","wrapper");document.body.prepend(t),t.append(function(){const t=e("header","header");t.dataset.id="header";const i=new l("instruction-link","https://www.nonograms.ru/instructions","How to play").buildLink();return i.setAttribute("target","_blank"),t.append(i),L(t),t}(),function(){const t=e("div","screen","main"),i=e("h1","title");return i.innerText="Nonograms",t.dataset.id="main",t.append(i),L(t),t}(),function(){const t=e("div","screen","game"),i=e("div","game-control"),s=(new r).buildField();return i.dataset.id="control",L(i),t.append(i,s,function(){const t=e("div","timer");return["hour","min","sec"].forEach((i=>{const s=e("span","timer__item");s.setAttribute("id",`${i}`),s.innerText="00",t.append(s)})),t}()),t}()),function(){const t=document.querySelector(".game"),i=document.querySelector("#select-level"),s=e("div"),n=e("div","level__list");i.setAttribute("popovertarget","level-items"),s.setAttribute("id","level-items"),s.setAttribute("popover",""),n.dataset.id="level",L(n),s.append(n),t.append(s)}()}(),document.querySelector(".game-control").addEventListener("click",(function(e){"button"===e.target.tagName.toLowerCase()&&"save-game"!==e.target.getAttribute("id")&&"show-solution"!==e.target.getAttribute("id")&&(document.querySelector("#save-game").disabled=!1)}))})();
//# sourceMappingURL=bundle.js.map