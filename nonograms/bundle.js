(()=>{"use strict";function t(t,...e){const i=document.createElement(t);return i.classList.add(...e),i}function e(t,...e){e.forEach((e=>t.append(e)))}function i(t){return t>=0&&t<10?`0${t}`:t}function s(){return document.querySelector(".sound-btn").classList.contains("crossed")}function n(){const t=document.querySelector(".game-field"),e=Array.from(document.querySelectorAll(".ceil")),i=e.filter((t=>"true"===t.dataset.fill)),s=e.filter((t=>"false"===t.dataset.fill));return{feild:t,allCeils:e,fillCeils:i,emptyCeil:s}}function c(){return{sec:document.querySelector("#sec"),min:document.querySelector("#min"),hour:document.querySelector("#hour")}}function l(){const{sec:t,min:e,hour:i}=c();return+t.innerText+60*+e.innerText+3600*+i.innerText}class a{constructor(t,e,i){this.classes=t,this.text=e,this.cb=i}buildBtn(){return this.btn=t("button",this.classes),"string"==typeof this.text&&(this.btn.innerText=this.text),this.cb&&this.btn.addEventListener("click",this.cb),this.btn}}class o{constructor(t,e,i){this.classes=t,this.href=e,this.text=i}buildLink(){return this.link=t("a",this.classes),this.link.setAttribute("href",this.href),this.link.innerText=this.text,this.link}}const r=JSON.parse('[{"id":"easy","size":5,"width":"60px","img":[{"id":"lion","src":"assets/images/lion.png","matrix":[[0,1,1,1,0],[1,1,1,1,0],[1,1,1,1,0],[0,1,1,1,1],[1,1,1,1,1]]},{"id":"rose","src":"assets/images/rose.png","matrix":[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[0,0,1,0,0]]},{"id":"piggy","src":"assets/images/piggy.png","matrix":[[1,1,1,1,0],[0,1,1,1,1],[1,1,0,1,0],[1,1,1,1,1],[1,1,1,1,0]]},{"id":"tree","src":"assets/images/tree.png","matrix":[[1,1,1,1,1],[1,1,0,1,1],[0,1,1,1,0],[0,0,1,0,0],[1,1,1,1,1]]},{"id":"duck","src":"assets/images/duck.png","matrix":[[0,1,1,1,0],[0,1,0,1,1],[0,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]]}]},{"id":"medium","size":10,"width":"33px","img":[{"id":"sunrise","src":"assets/images/sunrise.png","matrix":[[0,0,0,1,1,1,1,0,0,0],[0,0,1,1,0,0,1,1,0,0],[0,1,1,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,1,1,0],[0,1,1,0,0,0,0,1,1,0],[0,0,1,1,0,0,1,1,0,0],[0,0,0,1,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,0,0],[0,1,1,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1]]},{"id":"bamboo","src":"assets/images/bamboo.png","matrix":[[1,1,0,0,1,1,0,0,1,1],[1,1,0,1,1,1,0,0,1,1],[1,1,0,1,1,1,0,1,1,1],[1,1,0,0,1,1,0,1,1,1],[1,1,0,0,1,1,0,0,1,1],[1,1,1,0,1,1,0,0,1,1],[1,1,1,0,1,1,1,0,1,1],[1,1,0,0,1,1,1,0,1,1],[1,1,0,0,1,1,0,0,1,1],[1,1,0,0,1,1,0,0,1,1]]},{"id":"samurai","src":"assets/images/samurai.png","matrix":[[0,1,0,1,0,1,0,0,0,0],[0,1,0,1,1,1,1,0,0,0],[0,1,0,0,1,1,1,1,0,0],[0,1,0,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1],[0,1,0,0,1,1,1,0,0,0],[0,1,0,1,1,1,1,1,1,0],[1,1,1,1,1,1,1,1,1,1],[0,1,0,0,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,0]]},{"id":"fan","src":"assets/images/fan.png","matrix":[[0,1,1,0,0,0,0,0,0,0],[0,1,0,1,1,0,0,0,0,0],[0,1,1,1,1,0,0,0,0,0],[0,1,1,1,0,1,1,0,0,0],[0,1,1,0,1,1,1,0,0,0],[0,1,0,1,1,1,0,1,1,0],[0,1,1,1,1,0,1,1,1,0],[0,1,1,1,0,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1],[0,1,0,0,0,0,0,0,0,0]]},{"id":"gardener","src":"assets/images/gardener.png","matrix":[[0,0,0,0,1,1,1,1,0,0],[1,1,0,1,1,1,1,1,1,0],[1,1,0,1,1,1,1,0,1,0],[1,1,1,1,1,0,1,0,1,1],[0,0,1,1,0,0,0,0,1,1],[1,1,1,1,0,0,0,1,1,1],[0,1,1,1,1,0,0,1,1,1],[0,0,1,1,1,1,1,1,1,1],[0,0,0,0,1,1,1,1,1,1],[0,0,0,0,1,1,1,1,0,0]]}]},{"id":"hard","size":15,"width":"23px","img":[{"id":"lion","src":"assets/images/lev.png","matrix":[[0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],[0,1,1,0,0,1,1,1,1,0,1,1,0,0,0],[0,1,1,0,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,0,0,1,0,0,1,0,1,1,0,0,0],[0,1,1,1,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,0,0,0,0,0,0,0,1,1,0,0,0],[0,1,1,1,0,0,0,0,0,1,1,1,0,0,1],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,1],[0,0,1,1,1,1,1,1,1,1,1,0,0,0,1],[0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[1,1,0,0,0,1,1,1,0,0,0,1,1,0,0],[1,0,1,0,1,0,1,0,1,0,1,0,1,0,0]]},{"id":"pyramid","src":"assets/images/piramida.png","matrix":[[0,0,0,0,0,0,0,0,0,0,1,0,0,0,0],[0,0,1,1,0,0,0,0,0,1,1,1,0,0,0],[0,1,1,1,1,0,0,0,1,1,1,1,1,0,0],[0,1,1,1,1,0,0,1,1,1,1,1,1,1,0],[0,0,1,1,0,0,1,1,0,0,1,1,1,1,1],[0,0,0,0,0,1,1,0,0,1,1,1,1,1,1],[0,0,0,0,1,1,0,0,1,1,1,1,1,1,1],[0,0,0,1,1,0,0,1,1,1,1,1,1,1,1],[0,0,1,1,0,0,1,1,1,1,1,1,1,1,1],[0,1,1,0,0,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,1,1,1,1,1,0,1,1,1,0,1,1],[1,1,1,1,0,0,0,0,1,1,1,0,0,0,1],[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0]]},{"id":"flamingo","src":"assets/images/flamingo.png","matrix":[[0,0,1,1,1,1,0,0,0,0,0,0,0,0,0],[0,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,0,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,1,1,1,1,1,0,0],[0,0,1,1,1,1,0,1,1,1,1,1,1,1,0],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,0]]},{"id":"giraffe","src":"assets/images/zhiraf.png","matrix":[[0,0,1,0,1,0,0,0,0,0,0,0,0,0,0],[1,1,0,1,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,1,0,1,0,0,0,1,0,1,1],[0,0,0,0,0,1,0,1,0,0,0,1,0,1,0]]},{"id":"palm","src":"assets/images/palma.png","matrix":[[0,0,0,0,1,1,1,1,1,0,1,1,1,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,0],[0,0,0,0,0,0,1,1,1,1,1,1,1,0,0],[0,0,0,1,1,1,1,1,0,0,0,1,1,1,0],[0,0,1,1,1,1,1,1,0,0,0,0,1,1,1],[0,0,1,1,1,1,1,1,1,1,0,0,1,1,1],[0,0,1,0,0,1,1,1,1,1,1,0,1,1,1],[0,0,0,0,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,1,1,1,0,0,0,1,1,1,0,0,1],[0,0,1,1,1,0,0,0,0,1,1,0,0,0,0],[0,0,1,1,1,0,0,0,0,1,0,0,0,0,0],[0,1,1,1,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,0,0]]}]}]');class d{constructor(t=0,e=[],i="25px"){this.fiedSize=t,this.ceilSize=i,this.img=e}buildField(){return this.field=t("div","game-field"),e(this.field,this.buildTable(this.fiedSize,this.img),this.buildHint(this.fiedSize,this.ceilSize,"top"),this.buildHint(this.fiedSize,this.ceilSize,"left"),new a("sound-btn","",y).buildBtn()),this.field}buildTable(i,s){this.table=t("table","table");for(let n=0;n<i;n++){const c=t("tr","row");for(let l=0;l<i;l++){const i=t("td","ceil");i.style.width=this.ceilSize,i.style.height=this.ceilSize,i.dataset.coord=`${n}-${l}`,1===s[n][l]?i.dataset.fill=!0:i.dataset.fill=!1,e(c,i)}e(this.table,c)}return this.table.addEventListener("click",(t=>p(t))),this.table.addEventListener("contextmenu",(t=>{p(t),t.preventDefault()})),this.table.addEventListener("click",v,{once:!0}),this.table.addEventListener("click",x),this.table}buildHint(i,s,n){const c=[];this.hints=t("div",`${n}-hints`);for(let l=0;l<i;l++){const i=t("div",`${n}-hint`);i.setAttribute("id",`${l}`),c.push(i),"top"===n?i.style.width=s:"left"===n&&(i.style.height=s),e(this.hints,i)}return"top"===n?this.setHints(c,"column"):"left"===n&&this.setHints(c,"row"),this.hints}setHints(t,e){for(let i=0;i<this.fiedSize;i++){const s=t.find((t=>t.getAttribute("id")===`${i}`));let n=0;for(let t=0;t<this.fiedSize;t++)"row"===e&&1===this.img[i][t]&&(n+=1,t!==this.fiedSize-1&&0!==this.img[i][t+1]||(this.getHint(s,`${n}`),n=0)),"column"===e&&1===this.img[t][i]&&(n+=1,t!==this.fiedSize-1&&0!==this.img[t+1][i]||(this.getHint(s,`${n}`),n=0))}}getHint(i,s){this.hint=t("div","hint"),this.hint.innerText=s,this.hint.addEventListener("click",(t=>t.target.classList.toggle("hint--checked"))),e(i,this.hint)}}class m{constructor(t){this.classes=t}buildModal(i){return this.overlay=t("div","overlay"),this.modal=t("div",this.classes),this.closeBtn=t("button","close-btn"),this.closeBtn.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="30" height="30"><path d="M19,2H5C2.243,2,0,4.243,0,7v10c0,2.757,2.243,5,5,5h14c2.757,0,5-2.243,5-5V7c0-2.757-2.243-5-5-5Zm3,15c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V7c0-1.654,1.346-3,3-3h14c1.654,0,3,1.346,3,3v10Zm-5.793-7.793l-2.793,2.793,2.793,2.793c.391,.391,.391,1.023,0,1.414-.195,.195-.451,.293-.707,.293s-.512-.098-.707-.293l-2.793-2.793-2.793,2.793c-.195,.195-.451,.293-.707,.293s-.512-.098-.707-.293c-.391-.391-.391-1.023,0-1.414l2.793-2.793-2.793-2.793c-.391-.391-.391-1.023,0-1.414s1.023-.391,1.414,0l2.793,2.793,2.793-2.793c.391-.391,1.023-.391,1.414,0s.391,1.023,0,1.414Z"/></svg>',"string"==typeof i?this.modal.innerText=i:e(this.modal,i),e(this.modal,this.closeBtn),e(this.overlay,this.modal),this.overlay.addEventListener("click",this.closeModal),this.overlay}closeModal(t){(t.target.classList.contains("overlay")||t.target.classList.contains("close-btn"))&&(document.querySelector("audio")&&document.querySelector("audio").pause(),document.querySelector(".overlay").remove())}}let u,h,g={};function f(t){let e,i=0;"random-game"===t.target.getAttribute("id")&&(i=Math.floor(Math.random()*r.length)),e=r[i],w(e,e.img[Math.floor(Math.random()*e.img.length)])}function b(i){let s;s="change-puzzle"!==i.target.getAttribute("id")?i.target.getAttribute("id"):g.level;const n=r.find((t=>t.id===s)),c=t("div","modal-content");n.img.forEach((i=>{const s=t("div","modal-item","level-cont"),l=t("img","modal-img"),a=t("h6","item-title");a.innerText=`${i.id.toUpperCase()}`,l.setAttribute("src",`${i.src}`),s.addEventListener("click",(()=>{const t=n.img.find((t=>t.id===i.id));w(n,t),document.querySelector(".overlay").remove()})),e(s,l,a),e(c,s)})),e(document.body,new m("modal").buildModal(c))}function p(t){let e;t.target.classList.contains("ceil")&&("click"!==t.type||t.target.classList.contains("crossed")?"contextmenu"!==t.type||t.target.classList.contains("ceil--fill")||(e=new Audio("assets/sound/cross.mp3"),t.target.classList.toggle("crossed")):(e=new Audio("assets/sound/fill.mp3"),t.target.classList.toggle("ceil--fill")),s()||e.play())}function v(t,e=0,s=0,n=0){const{sec:l,min:a,hour:o}=c();let r=e,d=s,m=n;u=setInterval((function(){r++,r>59&&(d++,a.innerText=i(d),r=0),d>59&&(m++,o.innerText=i(m),d=0),l.innerText=i(r)}),1e3)}function x(){const i=t=>t.classList.contains("ceil--fill"),{feild:c,allCeils:a,fillCeils:o,emptyCeil:r}=n();o.every(i)&&!r.some(i)&&(clearInterval(u),a.forEach((t=>t.classList.remove("crossed"))),c.classList.add("game-field--disable"),function(i){const n=t("div","modal-item"),c=t("img","modal-img"),a=t("h6","item-title"),o=l(),r=t("audio","audio");r.setAttribute("src","assets/sound/happy.mp3"),a.innerText=`Great! You have solved the nonogram in ${o} seconds!`,c.setAttribute("src",`${i.src}`),e(n,a,r,c),e(document.body,new m("modal").buildModal(n)),s()||r.play()}(g),h.push({name:g.id,img:g.src,level:g.level,time:l()}),localStorage.setItem("wins",JSON.stringify(h)))}function y(t){t.target.classList.toggle("crossed"),t.target.classList.contains("crossed")?localStorage.setItem("sound","off"):localStorage.setItem("sound","on")}function S(){const{sec:t,min:e,hour:i}=c();t.innerText="00",e.innerText="00",i.innerText="00",clearInterval(u)}function w(t,e){const i=new d(t.size,e.matrix,t.width).buildField();document.querySelector(".game-field").replaceWith(i),"off"===localStorage.getItem("sound")&&document.querySelector(".sound-btn").classList.add("crossed"),S(),g.id=e.id,g.src=e.src,g.matrix=e.matrix,g.level=t.id,console.log(g)}h=localStorage.getItem("wins")?JSON.parse(localStorage.getItem("wins")):[],console.log(h);const L=[{parent:"header",buttons:[{content:"Best results",callback:function(){var i;(i=h).sort(((t,e)=>t.time-e.time)),i.length>5&&i.splice(5);const s=new m("modal"),n=function(i){const s=t("table","win-list"),n=t("tr","table-title"),c=t("th","win-descr");c.innerText="name";const l=t("th","win-descr");l.innerText="image";const a=t("th","win-descr");a.innerText="level";const o=t("th","win-descr");return o.innerText="time",e(n,c,l,a,o),e(s,n),i.forEach((i=>{const n=t("tr","win-item"),c=t("td","win-descr");c.innerText=i.name;const l=t("td","win-descr"),a=t("img","win-img");a.src=i.img,e(l,a);const o=t("td","win-descr");o.innerText=i.level;const r=t("td","win-descr");r.innerText=`${i.time} sec`,e(n,c,l,o,r),e(s,n)})),s}(h);e(document.body,s.buildModal(n))}},{content:"Change theme",callback:function(){const t="--theme: dark;";document.documentElement.style.cssText===t?(document.documentElement.style.cssText="",localStorage.setItem("theme","light")):(document.documentElement.style.cssText=t,localStorage.setItem("theme","dark"))}}]},{parent:"main",buttons:[{content:"New game",callback:function(t){f(t),t.target.parentNode.classList.add("up")}},{content:"Continue saved game",callback:function(){const t=JSON.parse(localStorage.savedGame),e=r.find((e=>e.id===t.level)),i=e.img.find((e=>e.id===t.id));w(e,i),document.querySelector("table").removeEventListener("click",v,{once:!0});const{curSec:s,curMin:n,curHour:l}=t.time,{sec:a,min:o,hour:d}=c();a.innerText=s,o.innerText=n,d.innerText=l,document.querySelectorAll(".ceil").forEach((e=>{const[i,s]=e.dataset.coord.split("-");1===t.currentMatrix[i][s]?e.classList.add("ceil--fill"):-1===t.currentMatrix[i][s]&&e.classList.add("crossed")})),document.querySelector("table").addEventListener("click",(t=>v(0,+s,+n,+l)),{once:!0}),event.target.parentNode.classList.add("up")}}]},{parent:"level",buttons:[{content:"Easy (5*5)",callback:b},{content:"Medium (10*10)",callback:b},{content:"Hard (15*15)",callback:b},{content:"Random game",callback:f}]},{parent:"control",buttons:[{content:"Select level"},{content:"Show solution",callback:function(){const{feild:t,allCeils:e,fillCeils:i,emptyCeil:s}=n();e.forEach((t=>t.classList.remove("ceil--fill","crossed"))),i.forEach((t=>t.classList.add("ceil--fill"))),s.forEach((t=>t.classList.add("crossed"))),t.classList.add("game-field--disable"),clearInterval(u)}},{content:"Reset game",callback:function(){const t=n().allCeils,e=n().feild,i=document.querySelector(".table");t.forEach((t=>t.classList.remove("ceil--fill","crossed"))),e.classList.contains("game-field--disable")&&(e.classList.remove("game-field--disable"),i.addEventListener("click",v,{once:!0}),S())}},{content:"Change puzzle",callback:b},{content:"Save game",callback:function(){const{sec:t,min:i,hour:s}=c(),n={curSec:t.innerText,curMin:i.innerText,curHour:s.innerText},l={};Object.assign(l,g);const a=JSON.parse(JSON.stringify(g.matrix));document.querySelectorAll(".ceil").forEach((t=>{const[e,i]=t.dataset.coord.split("-");t.classList.contains("ceil--fill")?a[e][i]=1:t.classList.contains("crossed")?a[e][i]=-1:a[e][i]=0})),l.currentMatrix=a,l.time=n,e(document.body,new m("modal").buildModal("the game was saved")),setTimeout((()=>document.querySelector(".overlay").remove()),1e3),localStorage.savedGame=JSON.stringify(l)}},{content:"Main page",callback:function(){document.querySelectorAll(".screen").forEach((t=>t.classList.remove("up")))}}]}];function k(t){L.find((e=>e.parent===t.dataset.id)).buttons.forEach((i=>{const s=i.content,n=s.match(/[^*)(\d]/gi).join("").trim(),c=i.callback,l=new a("btn",s,c).buildBtn();l.setAttribute("id",`${n.toLowerCase().split(" ").join("-")}`),e(t,l),t.classList.contains("level__list")&&(l.setAttribute("popovertargetaction","hide"),l.setAttribute("popovertarget","level-items"))}))}!function(){"dark"===localStorage.getItem("theme")&&(document.documentElement.style.cssText="--theme: dark;");const i=t("div","wrapper");document.body.prepend(i),e(i,function(){const i=t("header","header");i.dataset.id="header";const s=new o("instruction-link","https://www.nonograms.ru/instructions","How to play").buildLink();return s.setAttribute("target","_blank"),e(i,s),k(i),i}(),function(){const i=t("div","screen","main"),s=t("h1","title");return s.innerText="Nonograms",i.dataset.id="main",e(i,s),k(i),i}(),function(){const i=t("div","screen","game"),s=t("div","game-control"),n=(new d).buildField();return s.dataset.id="control",k(s),e(i,s,n,function(){const i=t("div","timer");return["hour","min","sec"].forEach((s=>{const n=t("span","timer__item");n.setAttribute("id",`${s}`),n.innerText="00",e(i,n)})),i}()),i}()),function(){const i=document.querySelector(".game"),s=document.querySelector("#select-level"),n=t("div"),c=t("div","level__list");s.setAttribute("popovertarget","level-items"),n.setAttribute("id","level-items"),n.setAttribute("popover",""),c.dataset.id="level",k(c),e(n,c),e(i,n)}()}()})();
//# sourceMappingURL=bundle.js.map